
<% content_for :title, Page.all.count==0 ? "Nothing yet" : "C247" %>
<% if Page.all.count > 0%>
	<dl class="tabs" data-tab>
		<% Page.roots.each do |page| %>
		<% if page.icon.nil? %>
			<% if @page != nil%>
				<dd> <%= link_to page.name, page, class: ("active" if @page.root==page) %></dd>
			<% else %>
				<dd> <%= link_to page.name, page %></dd>
			<% end%>
	
		<% else %>
			<% if current_top_page?(page)%>
				<% filename="icons/#{page.icon.split('/').last}"%>
			<% else %>
				<% filename="icons/#{page.sec_icon.split('/').last}"%>
			<%end%>
			<% if @page != nil%>
				<dd> <%= link_to  (image_tag filename), page, class: ("active" if current_top_page?(page))  %></dd>
			<% else %>
				<dd>  <%= link_to (image_tag filename), page %></dd>
			<%end%>
		<% end %>
	<% end%>
</dl>
<!--div id="submenu">
<% if Page.all.count > 0 %>
<% if @page != nil %>
<%= render 'submenu_pages', pages: @page.root.descendants.arrange %>
<% end %>
<% end %>
</div-->
<% end %>

<div id="breadcrumbs">
	<% if Page.all.count > 0 %>
	<% if @page != nil%>
		<% @page.ancestors.each do |page| %>
			<b><%= link_to page.name , page %></b> &gt;
		<% end %>
		<%end%>
	<% end %>
</div>
<p id="notice"><%= notice %></p>

<h1>  
	<% if Page.all.count != 0 %>
	<% if @page != nil%>
		<%= @page.name %>
		<% end%> 
	<%else%>
	<div id="container">
	<p>
	Oye you have an empty database! Contact your admin or </p>
	<p> 
	<%= link_to (image_tag 'build-icon.png'), pages_path %> <b>Build It Yourself! </b> 
	</p>
</div>
	<%end%>
</h1>

	
<% if Page.all.count != 0%>
<% if @page != nil%>
<% if @page.children.count > 0 %>
<div class="row" id="boardcontainer">
	<div style="border: 0px solid black" class="small-12 large-12 large-centered columns text-center">
		<ul id="board" class="large-block-grid-4 small-block-grid-4 large-centered"">
			<% @page.children.each do |pchild|%>
				<% if pchild.icon.nil? %>
					<li> <%= link_to pchild.name, pchild, class: ("active" if pchild.root==pchild) %></li>
				<%else%>
					<li><%= link_to (image_tag "icons/#{pchild.icon.split('/').last}") ,pchild %></li>
				<%end%>
			<% end %>
		</ul>
	</div>
</div>

<% elsif @page.mappable?%>
	<%  @coordinates ||= Geocoder.coordinates(@rip) %>
	<b> Latitude:<%= @coordinates.first %> Longitude:<%=@coordinates.second %> </b>
<% elsif @page.searchable?%>
	<%  @coordinates ||= Geocoder.coordinates(@rip) %>
	<% @address=Geocoder.address(@coordinates)%>
		<%keywords=@page.keywords %>
		<%typedkeywords=keywords.split(",")%>
		<%keyword=typedkeywords*"|"%>
		<%parentType=@page.parent.searchType==nil ? "" : @page.parent.searchType%>
		<%parentKeyword=@page.parent.keywords==nil ? "" : @page.parent.keywords%>
		<%mysearchType=@page.searchType==nil ? "" : @page.searchType%>
		<%mytype=mysearchType+","+parentType+","+parentKeyword%>
		<%type=mytype.split(",")*"|"%>
		
	<%@placesurl="https://maps.googleapis.com/maps/api/place/nearbysearch/json?location=#{@coordinates.first},#{@coordinates.second}&radius=8000&type=#{type}&keyword=#{keyword}&sensor=false&key=AIzaSyCiIVlMotGTHUdGu-3bNbcbgfOXkkOSYoY"%>
	
	<% resp = Net::HTTP.get_response(URI.parse(URI.encode(@placesurl)))%>
    <%data = resp.body%>
	<%results=JSON.parse(data)%>
	<% reds= results["results"]%>
	
	<%@mapurl="http://maps.google.com/maps/api/staticmap?size=640x480&zoom=11&sensor=false&markers=color:green%7clabel:H%7c#{@coordinates.first}%2C#{@coordinates.second}"%>
	<table>
		<tr>
			<td>
				<%x=65%>
				<%reds.each do |red|%>
					<%@mapurl+="&markers=color:blue%7clabel:#{x.chr}%7c#{red["geometry"]["location"]["lat"]}%2C#{red["geometry"]["location"]["lng"]}"%>
					<%x=x+1%>
				<%end%>
				<%= image_tag @mapurl %>
			</td>
			<td width="250">	
				<%x=64%>
				<div>
					<ul>
						<%reds.each do |red|%>
							<%x=x+1%>
							<li>
								<a href="#"><h4>(<%=x.chr%>) <%= red["name"]%><br><%=red["vicinity"]%></h4>
								<%price=red["price_level"].to_i%>
								<%rating=red["rating"].to_i%>
								<b>|<%=price%>$|<%=rating%>stars| </b></a>
							</li>
						<%end%>
					</ul>
				</div>
			</td>
		</tr>
	</table>

<% else %>

<%= simple_format @page.content %>
<% end %>
<% end %>
<% end %>

<!--p>
<% if Page.all.count > 0 %>
<%= link_to 'Edit', edit_page_path(@page) %> |
<%= link_to 'Show', @page %> |
<%= link_to 'Back', pages_path %>
<% end %>
</p -->
